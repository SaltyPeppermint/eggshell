mod analysis;
mod appliers;
mod db;
mod kind;
mod lang;
mod nat;
mod pp;
mod predicates;
mod rules;

use egg::{EGraph, ENodeOrVar, Pattern, PatternAst, Subst};
use egg::{Id, Language, RecExpr};

pub use analysis::RiseAnalysis;
pub use lang::Rise;
pub use pp::PrettyPrint;
pub use predicates::RisePredicate;
pub use predicates::compute_upstream_sizes_hook;
pub use rules::{Ruleset, rules};

use crate::sketch::{Sketch, SketchLang};
use crate::utils;

#[must_use]
pub fn sketchify<F: Fn(&Rise) -> bool>(expr: &RecExpr<Rise>, also_sketchify: &F) -> Sketch<Rise> {
    fn rec<F: Fn(&Rise) -> bool>(
        expr: &RecExpr<Rise>,
        id: Id,
        also_sketchify: &F,
        sketch: &mut Sketch<Rise>,
    ) -> Id {
        match &expr[id] {
            Rise::Var(_) | Rise::TypedVar(_, _) => sketch.add(SketchLang::Any),
            other if also_sketchify(other) => sketch.add(SketchLang::Any),
            other => {
                let new_node = SketchLang::Node(
                    other
                        .clone()
                        .map_children(|c_id| rec(expr, c_id, also_sketchify, sketch)),
                );
                sketch.add(new_node)
            }
        }
    }
    let mut sketch = RecExpr::default();
    rec(expr, expr.root(), also_sketchify, &mut sketch);
    sketch
}

#[must_use]
pub fn canon_nat(expr: &RecExpr<Rise>) -> RecExpr<Rise> {
    fn rec(expr: &RecExpr<Rise>, id: Id, canon_expr: &mut RecExpr<Rise>) -> Id {
        let node = &expr[id];
        if let Ok(canon_nat_expr) = nat::try_simplify(&node.build_recexpr(|i| expr[i].clone())) {
            utils::add_expr(canon_expr, canon_nat_expr)
        } else {
            let new_node = node
                .clone()
                .map_children(|c_id| rec(expr, c_id, canon_expr));
            canon_expr.add(new_node)
        }
    }
    let mut canon_expr = RecExpr::default();
    rec(expr, expr.root(), &mut canon_expr);
    canon_expr
}

fn extract_small(
    egraph: &EGraph<Rise, RiseAnalysis>,
    pattern: &Pattern<Rise>,
    subst: &Subst,
) -> Option<RecExpr<Rise>> {
    fn rec(
        ast: &PatternAst<Rise>,
        id: Id,
        subst: &Subst,
        egraph: &EGraph<Rise, RiseAnalysis>,
    ) -> Option<RecExpr<Rise>> {
        match &ast[id] {
            ENodeOrVar::Var(w) => egraph[subst[*w]].data.small_repr(egraph),
            ENodeOrVar::ENode(e) => {
                let mut expr = RecExpr::default();
                let mut new_node = e.clone();
                for c_id in new_node.children_mut() {
                    *c_id = utils::add_expr(&mut expr, rec(ast, *c_id, subst, egraph)?);
                }
                expr.add(new_node);
                Some(expr)
            }
        }
    }
    rec(&pattern.ast, pattern.ast.root(), subst, egraph)
}

// #[expect(clippy::missing_errors_doc)]
// pub fn illegal_array_hook(r: &mut Runner<Rise, RiseAnalysis>) -> Result<(), String> {
//     let illegal_searcher = pat("(arrT ?0 ?1)");
//     let illegal_matches = illegal_searcher.search(&r.egraph);
//     for i in illegal_matches {
//         for s in i.substs {
//             let repr_term = extract_small(&r.egraph, &illegal_searcher, &s).unwrap();
//             println!("TERM: {repr_term}");
//         }
//     }
//     println!("---");
//     Ok(())
// }

// START TERM
pub const MM: &str = "(typeOf (natLam (typeOf (natLam (typeOf (natLam (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) (arrT %n1 f32)) (fun (arrT %n2 (arrT %n0 f32)) (arrT %n2 (arrT %n1 f32))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) f32) (fun (arrT %n1 (arrT %n0 f32)) (arrT %n1 f32)))) (typeOf (lam (typeOf (app (typeOf (app (typeOf (app (typeOf reduce (fun (fun f32 (fun f32 f32)) (fun f32 (fun (arrT %n0 f32) f32)))) (typeOf add (fun f32 (fun f32 f32)))) (fun f32 (fun (arrT %n0 f32) f32))) (typeOf 0.0 f32)) (fun (arrT %n0 f32) f32)) (typeOf (app (typeOf (app (typeOf map (fun (fun (pairT f32 f32) f32) (fun (arrT %n0 (pairT f32 f32)) (arrT %n0 f32)))) (typeOf (lam (typeOf (app (typeOf (app (typeOf mul (fun f32 (fun f32 f32))) (typeOf (app (typeOf fst (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) (fun f32 f32)) (typeOf (app (typeOf snd (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) f32)) (fun (pairT f32 f32) f32))) (fun (arrT %n0 (pairT f32 f32)) (arrT %n0 f32))) (typeOf (app (typeOf (app (typeOf zip (fun (arrT %n0 f32) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))))) (typeOf %e1 (arrT %n0 f32))) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32)))) (typeOf %e0 (arrT %n0 f32))) (arrT %n0 (pairT f32 f32)))) (arrT %n0 f32))) f32)) (fun (arrT %n0 f32) f32))) (fun (arrT %n1 (arrT %n0 f32)) (arrT %n1 f32))) (typeOf (app (typeOf transpose (fun (arrT %n0 (arrT %n1 f32)) (arrT %n1 (arrT %n0 f32)))) (typeOf %e1 (arrT %n0 (arrT %n1 f32)))) (arrT %n1 (arrT %n0 f32)))) (arrT %n1 f32))) (fun (arrT %n0 f32) (arrT %n1 f32)))) (fun (arrT %n2 (arrT %n0 f32)) (arrT %n2 (arrT %n1 f32)))) (typeOf %e1 (arrT %n2 (arrT %n0 f32)))) (arrT %n2 (arrT %n1 f32)))) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))) (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))) (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))) (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))))) (natFun (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))))";

// GUIDES
pub const SPLIT_GUIDE: &str = "(typeOf (natLam (typeOf (natLam (typeOf (natLam (typeOf (lam (typeOf (lam (typeOf (app (typeOf join (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))) (arrT %n2 (arrT %n1 f32)))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT %n1 f32))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32)))))) (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) (arrT %n1 f32)) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT %n1 f32))))) (typeOf (lam (typeOf (app (typeOf join (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)) (arrT %n1 f32))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT %n0 f32)) (arrT 32n f32)) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32))))) (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) f32) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n f32)))) (typeOf (lam (typeOf (app (typeOf (app (typeOf (app (typeOf reduceSeq (fun (fun f32 (fun (arrT 4n (pairT f32 f32)) f32)) (fun f32 (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))) f32)))) (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf add (fun f32 (fun f32 f32))) (typeOf %e1 f32)) (fun f32 f32)) (typeOf (app (typeOf (app (typeOf (app (typeOf reduceSeq (fun (fun f32 (fun (pairT f32 f32) f32)) (fun f32 (fun (arrT 4n (pairT f32 f32)) f32)))) (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf add (fun f32 (fun f32 f32))) (typeOf %e1 f32)) (fun f32 f32)) (typeOf (app (typeOf (app (typeOf mul (fun f32 (fun f32 f32))) (typeOf (app (typeOf fst (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) (fun f32 f32)) (typeOf (app (typeOf snd (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) f32)) f32)) (fun (pairT f32 f32) f32))) (fun f32 (fun (pairT f32 f32) f32)))) (fun f32 (fun (arrT 4n (pairT f32 f32)) f32))) (typeOf 0.0 f32)) (fun (arrT 4n (pairT f32 f32)) f32)) (typeOf %e0 (arrT 4n (pairT f32 f32)))) f32)) f32)) (fun (arrT 4n (pairT f32 f32)) f32))) (fun f32 (fun (arrT 4n (pairT f32 f32)) f32)))) (fun f32 (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))) f32))) (typeOf 0.0 f32)) (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))) f32)) (typeOf (app (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n1 (natMul (natPow 4n -1n) %n0)) (pairT f32 f32)) (arrT (natMul (natPow 4n -1n) %n1) (arrT %n0 (pairT f32 f32)))))) 4n) (fun (arrT %n0 (pairT f32 f32)) (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))))) (typeOf (app (typeOf (app (typeOf zip (fun (arrT %n0 f32) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))))) (typeOf %e1 (arrT %n0 f32))) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32)))) (typeOf %e0 (arrT %n0 f32))) (arrT %n0 (pairT f32 f32)))) (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))))) f32)) (fun (arrT %n0 f32) f32))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n f32)))) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))) (typeOf (app (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n2 (natMul (natPow 32n -1n) %n0)) (arrT %n1 f32)) (arrT (natMul (natPow 32n -1n) %n2) (arrT %n0 (arrT %n1 f32)))))) 32n) (fun (arrT %n1 (arrT %n0 f32)) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))))) (typeOf (app (typeOf transpose (fun (arrT %n0 (arrT %n1 f32)) (arrT %n1 (arrT %n0 f32)))) (typeOf %e1 (arrT %n0 (arrT %n1 f32)))) (arrT %n1 (arrT %n0 f32)))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))) (arrT %n1 f32))) (fun (arrT %n0 f32) (arrT %n1 f32)))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT %n1 f32))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))))) (typeOf (app (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n3 (natMul (natPow 32n -1n) %n0)) (arrT %n1 f32)) (arrT (natMul (natPow 32n -1n) %n3) (arrT %n0 (arrT %n1 f32)))))) 32n) (fun (arrT %n2 (arrT %n0 f32)) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))))) (typeOf %e1 (arrT %n2 (arrT %n0 f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))))) (arrT %n2 (arrT %n1 f32)))) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))) (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))) (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))) (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))))) (natFun (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))))";
pub const REORDER_1_GUIDE: &str = "";
pub const REORDER_2_GUIDE: &str = "";
pub const STORE_GUIDE: &str = "";

// GOALS
pub const BASELINE_GOAL: &str = "(typeOf (natLam (typeOf (natLam (typeOf (natLam (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) (arrT %n1 f32)) (fun (arrT %n2 (arrT %n0 f32)) (arrT %n2 (arrT %n1 f32))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) f32) (fun (arrT %n1 (arrT %n0 f32)) (arrT %n1 f32)))) (typeOf (lam (typeOf (app (typeOf (app (typeOf (app (typeOf reduceSeq (fun (fun f32 (fun (pairT f32 f32) f32)) (fun f32 (fun (arrT %n0 (pairT f32 f32)) f32)))) (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf add (fun f32 (fun f32 f32))) (typeOf %e1 f32)) (fun f32 f32)) (typeOf (app (typeOf (lam (typeOf (app (typeOf (app (typeOf mul (fun f32 (fun f32 f32))) (typeOf (app (typeOf fst (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) (fun f32 f32)) (typeOf (app (typeOf snd (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) f32)) (fun (pairT f32 f32) f32)) (typeOf %e0 (pairT f32 f32))) f32)) f32)) (fun (pairT f32 f32) f32))) (fun f32 (fun (pairT f32 f32) f32)))) (fun f32 (fun (arrT %n0 (pairT f32 f32)) f32))) (typeOf 0.0 f32)) (fun (arrT %n0 (pairT f32 f32)) f32)) (typeOf (app (typeOf (app (typeOf zip (fun (arrT %n0 f32) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))))) (typeOf %e1 (arrT %n0 f32))) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32)))) (typeOf %e0 (arrT %n0 f32))) (arrT %n0 (pairT f32 f32)))) f32)) (fun (arrT %n0 f32) f32))) (fun (arrT %n1 (arrT %n0 f32)) (arrT %n1 f32))) (typeOf (app (typeOf transpose (fun (arrT %n0 (arrT %n1 f32)) (arrT %n1 (arrT %n0 f32)))) (typeOf %e1 (arrT %n0 (arrT %n1 f32)))) (arrT %n1 (arrT %n0 f32)))) (arrT %n1 f32))) (fun (arrT %n0 f32) (arrT %n1 f32)))) (fun (arrT %n2 (arrT %n0 f32)) (arrT %n2 (arrT %n1 f32)))) (typeOf %e1 (arrT %n2 (arrT %n0 f32)))) (arrT %n2 (arrT %n1 f32)))) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))) (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))) (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))) (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))))) (natFun (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))))";
pub const BLOCKING_GOAL: &str = "(typeOf (natLam (typeOf (natLam (typeOf (natLam (typeOf (lam (typeOf (lam (typeOf (app (typeOf join (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))) (arrT %n2 (arrT %n1 f32)))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32))) (arrT 32n (arrT %n1 f32))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32)))))) (typeOf (app (typeOf map (fun (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)) (arrT %n1 f32)) (fun (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32))) (arrT 32n (arrT %n1 f32))))) (typeOf join (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)) (arrT %n1 f32)))) (fun (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32))) (arrT 32n (arrT %n1 f32))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32))) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32))))))) (typeOf transpose (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32))) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32))))))) (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32))) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf (app (typeOf reduceSeq (fun (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32)))))) (typeOf (lam (typeOf (lam (typeOf (app (typeOf (lam (typeOf (app (typeOf (app (typeOf (app (typeOf reduceSeq (fun (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (pairT f32 f32))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT 4n (arrT 32n (arrT 32n (pairT f32 f32)))) (arrT 32n (arrT 32n f32)))))) (typeOf (lam (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))) (arrT 32n f32)) (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32)))) (arrT 32n (arrT 32n f32))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (pairT f32 (pairT f32 f32)) f32) (fun (arrT 32n (pairT f32 (pairT f32 f32))) (arrT 32n f32)))) (typeOf (lam (typeOf (app (typeOf (app (typeOf add (fun f32 (fun f32 f32))) (typeOf (app (typeOf fst (fun (pairT f32 (pairT f32 f32)) f32)) (typeOf %e0 (pairT f32 (pairT f32 f32)))) f32)) (fun f32 f32)) (typeOf (app (typeOf (app (typeOf mul (fun f32 (fun f32 f32))) (typeOf (app (typeOf fst (fun (pairT f32 f32) f32)) (typeOf (app (typeOf snd (fun (pairT f32 (pairT f32 f32)) (pairT f32 f32))) (typeOf %e0 (pairT f32 (pairT f32 f32)))) (pairT f32 f32))) f32)) (fun f32 f32)) (typeOf (app (typeOf snd (fun (pairT f32 f32) f32)) (typeOf (app (typeOf snd (fun (pairT f32 (pairT f32 f32)) (pairT f32 f32))) (typeOf %e0 (pairT f32 (pairT f32 f32)))) (pairT f32 f32))) f32)) f32)) f32)) (fun (pairT f32 (pairT f32 f32)) f32))) (fun (arrT 32n (pairT f32 (pairT f32 f32))) (arrT 32n f32))) (typeOf (app (typeOf (app (typeOf zip (fun (arrT 32n f32) (fun (arrT 32n (pairT f32 f32)) (arrT 32n (pairT f32 (pairT f32 f32)))))) (typeOf (app (typeOf fst (fun (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))) (arrT 32n f32))) (typeOf %e0 (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))))) (arrT 32n f32))) (fun (arrT 32n (pairT f32 f32)) (arrT 32n (pairT f32 (pairT f32 f32))))) (typeOf (app (typeOf snd (fun (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))) (arrT 32n (pairT f32 f32)))) (typeOf %e0 (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))))) (arrT 32n (pairT f32 f32)))) (arrT 32n (pairT f32 (pairT f32 f32))))) (arrT 32n f32))) (fun (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))) (arrT 32n f32)))) (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32)))) (arrT 32n (arrT 32n f32)))) (typeOf (app (typeOf (app (typeOf zip (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (pairT f32 f32))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32))))))) (typeOf %e1 (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n (pairT f32 f32))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32)))))) (typeOf %e0 (arrT 32n (arrT 32n (pairT f32 f32))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (pairT f32 f32)))))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n (pairT f32 f32))) (arrT 32n (arrT 32n f32))))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (pairT f32 f32))) (arrT 32n (arrT 32n f32)))))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT 4n (arrT 32n (arrT 32n (pairT f32 f32)))) (arrT 32n (arrT 32n f32))))) (typeOf (app (typeOf fst (fun (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32)))) (typeOf (app (typeOf unzip (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))) (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (fun (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))))))) (typeOf unzip (fun (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))) (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf %e0 (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT 32n (arrT 32n f32)))) (fun (arrT 4n (arrT 32n (arrT 32n (pairT f32 f32)))) (arrT 32n (arrT 32n f32)))) (typeOf (app (typeOf transpose (fun (arrT 32n (arrT 4n (arrT 32n (pairT f32 f32)))) (arrT 4n (arrT 32n (arrT 32n (pairT f32 f32)))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT 4n (pairT f32 f32))) (arrT 4n (arrT 32n (pairT f32 f32)))) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 4n (arrT 32n (pairT f32 f32))))))) (typeOf transpose (fun (arrT 32n (arrT 4n (pairT f32 f32))) (arrT 4n (arrT 32n (pairT f32 f32)))))) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 4n (arrT 32n (pairT f32 f32)))))) (typeOf (app (typeOf snd (fun (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))))) (typeOf (app (typeOf unzip (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))) (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (fun (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))))))) (typeOf unzip (fun (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))) (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf %e0 (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (pairT (arrT 32n (arrT 32n f32)) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT 32n (arrT 4n (arrT 32n (pairT f32 f32)))))) (arrT 4n (arrT 32n (arrT 32n (pairT f32 f32)))))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32)))) (typeOf (app (typeOf (app (typeOf map (fun (fun (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))) (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf zip (fun (arrT 32n f32) (fun (arrT 32n (arrT 4n (pairT f32 f32))) (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (typeOf (app (typeOf fst (fun (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n f32))) (typeOf %e0 (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT 32n f32))) (fun (arrT 32n (arrT 4n (pairT f32 f32))) (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))))) (typeOf (app (typeOf snd (fun (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 4n (pairT f32 f32))))) (typeOf %e0 (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32)))))) (fun (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (fun (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (typeOf (app (typeOf (app (typeOf zip (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32)))))))) (typeOf %e1 (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf %e0 (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT 32n (pairT (arrT 32n f32) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT 32n (arrT 32n (pairT f32 (arrT 4n (pairT f32 f32))))))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 32n f32))))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32)))) (arrT 32n (arrT 32n f32)))))) (fun (arrT 32n (arrT 32n f32)) (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32))))) (typeOf (app (typeOf generate (fun (fun (idxT 32n) (arrT 32n f32)) (arrT 32n (arrT 32n f32)))) (typeOf (lam (typeOf (app (typeOf generate (fun (fun (idxT 32n) f32) (arrT 32n f32))) (typeOf (lam (typeOf 0.0 f32)) (fun (idxT 32n) f32))) (arrT 32n f32))) (fun (idxT 32n) (arrT 32n f32)))) (arrT 32n (arrT 32n f32)))) (fun (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32)))) (typeOf (app (typeOf transpose (fun (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf %e0 (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT 32n (arrT 32n f32)))) (fun (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))) (arrT 32n (arrT 32n f32))))) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))))))) (typeOf transpose (fun (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))))))) (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (typeOf (lam (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT 32n (arrT %n0 f32)) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))))) (typeOf (lam (typeOf (app (typeOf transpose (fun (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32)))) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 (pairT f32 f32)) (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32)))) (fun (arrT 32n (arrT %n0 (pairT f32 f32))) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32))))))) (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n1 (natMul (natPow 4n -1n) %n0)) (pairT f32 f32)) (arrT (natMul (natPow 4n -1n) %n1) (arrT %n0 (pairT f32 f32)))))) 4n) (fun (arrT %n0 (pairT f32 f32)) (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32)))))) (fun (arrT 32n (arrT %n0 (pairT f32 f32))) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32)))))) (typeOf (app (typeOf (app (typeOf map (fun (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT %n0 (pairT f32 f32)))))) (typeOf (app (typeOf zip (fun (arrT %n0 f32) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))))) (typeOf %e1 (arrT %n0 f32))) (fun (arrT %n0 f32) (arrT %n0 (pairT f32 f32))))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT %n0 (pairT f32 f32))))) (typeOf %e0 (arrT 32n (arrT %n0 f32)))) (arrT 32n (arrT %n0 (pairT f32 f32))))) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 4n (pairT f32 f32)))))) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))) (fun (arrT 32n (arrT %n0 f32)) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (typeOf (app (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n2 (natMul (natPow 32n -1n) %n0)) (arrT %n1 f32)) (arrT (natMul (natPow 32n -1n) %n2) (arrT %n0 (arrT %n1 f32)))))) 32n) (fun (arrT %n1 (arrT %n0 f32)) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))))) (typeOf (app (typeOf transpose (fun (arrT %n0 (arrT %n1 f32)) (arrT %n1 (arrT %n0 f32)))) (typeOf %e1 (arrT %n0 (arrT %n1 f32)))) (arrT %n1 (arrT %n0 f32)))) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT %n0 f32))))) (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))) (fun (arrT %n0 f32) (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32)))))))) (fun (arrT 32n (arrT %n0 f32)) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (fun (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (typeOf (app (typeOf (natApp (typeOf split (natFun (fun (arrT (natMul %n3 (natMul (natPow 32n -1n) %n0)) (arrT %n1 f32)) (arrT (natMul (natPow 32n -1n) %n3) (arrT %n0 (arrT %n1 f32)))))) 32n) (fun (arrT %n2 (arrT %n0 f32)) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))))) (typeOf %e1 (arrT %n2 (arrT %n0 f32)))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n0 f32))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT (natMul (natPow 4n -1n) %n0) (arrT 32n (arrT 4n (pairT f32 f32))))))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n (arrT 32n f32)))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT (natMul (natPow 32n -1n) %n1) (arrT 32n f32)))))) (arrT (natMul (natPow 32n -1n) %n2) (arrT 32n (arrT %n1 f32))))) (arrT %n2 (arrT %n1 f32)))) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))) (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))) (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))) (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32)))))))) (natFun (natFun (natFun (fun (arrT %n2 (arrT %n0 f32)) (fun (arrT %n0 (arrT %n1 f32)) (arrT %n2 (arrT %n1 f32))))))))";
pub const VECTORIZATION_GOAL: &str = "";
pub const LOOP_PERM_GOAL: &str = "";
pub const ARRAY_PACKING_GOAL: &str = "";
pub const CACHE_BLOCKS_GOAL: &str = "";
pub const PARALLEL_GOAL: &str = "";

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn mm_first() {
        let mm: RecExpr<Rise> = MM.parse().unwrap();
        println!("mm nodes: {}", mm.len());
    }

    #[test]
    fn mm_terms_parse() {
        // START TERM
        let mm: RecExpr<Rise> = MM.parse().unwrap();
        println!("mm nodes: {}", mm.len());

        // GUIDES
        let split_guide: RecExpr<Rise> = SPLIT_GUIDE.parse().unwrap();
        println!("split_guide nodes: {}", split_guide.len());
        let reorder_1_guide: RecExpr<Rise> = REORDER_1_GUIDE.parse().unwrap();
        println!("reorder_1_guide nodes: {}", reorder_1_guide.len());
        let reorder_2_guide: RecExpr<Rise> = REORDER_2_GUIDE.parse().unwrap();
        println!("reorder_2_guide nodes: {}", reorder_2_guide.len());
        let store_guide: RecExpr<Rise> = STORE_GUIDE.parse().unwrap();
        println!("store_guide nodes: {}", store_guide.len());

        // GOALS
        let baseline_goal: RecExpr<Rise> = BASELINE_GOAL.parse().unwrap();
        println!("baseline_goal nodes: {}", baseline_goal.len());
        let blocking_goal: RecExpr<Rise> = BLOCKING_GOAL.parse().unwrap();
        println!("blocking_goal: {}", blocking_goal.len());
        let vectorization_goal: RecExpr<Rise> = VECTORIZATION_GOAL.parse().unwrap();
        println!("vectorization_goal: {}", vectorization_goal.len());
        let loop_perm_goal: RecExpr<Rise> = LOOP_PERM_GOAL.parse().unwrap();
        println!("loop_perm_goal nodes: {}", loop_perm_goal.len());
        let array_packing_goal: RecExpr<Rise> = ARRAY_PACKING_GOAL.parse().unwrap();
        println!("array_packing_goal: {}", array_packing_goal.len());
        let cache_blocks_goal: RecExpr<Rise> = CACHE_BLOCKS_GOAL.parse().unwrap();
        println!("cache_blocks_goal {}", cache_blocks_goal.len());
        let parallel_goal: RecExpr<Rise> = PARALLEL_GOAL.parse().unwrap();
        println!("parallel_goal: {}", parallel_goal.len());
    }
}
